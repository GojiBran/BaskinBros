<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BaskinBros | Goji Software List</title>

<meta name="description" content="A categorized list of software used for tinkering, dev, media, retro/emulation, remote control, and more.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://baskinbros.com/software">

<meta property="og:title" content="BaskinBros Software List">
<meta property="og:description" content="Curated tools for tinkering, dev, media, retro/emulation, and more.">
<meta property="og:url" content="https://baskinbros.com/software">
<meta property="og:type" content="website">
<meta property="og:image" content="https://baskinbros.com/images/og-image.jpg">

<meta name="twitter:card" content="summary_large_image">
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#202020">
<link rel="icon" href="/favicon.ico">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

<style>
body {
  background:#202020;
  color:#99cc33;
  font-family:"Press Start 2P", monospace;
  text-shadow:0 0 4px #99cc33;
  padding-top:70px;
}
.navbar{background:#202020;border-bottom:1px solid #99cc33;}
.navbar-brand,.navbar-text{color:#99cc33!important;font-size:.75rem;}
h1{font-size:1rem;}
p{font-size:.7rem;color:#d8d8d8;text-shadow:none;}

.accordion-button{
  background:#111!important;
  color:#99cc33!important;
  border:1px solid #99cc33;
  font-size:.8rem;
}
.accordion-body{
  background:#181818;
  border:1px solid #99cc33;
}

.card{
  background:#111;
  border:1px solid #99cc33;
  height:100%;
}
.card-title{font-size:.75rem;color:#99cc33;}
.card-text{font-size:.65rem;color:#cfcfcf;text-shadow:none;}
.card-img-top{
  height:120px;
  object-fit:contain;
  background:#000;
  border-bottom:1px solid #99cc33;
}
.btn-goji{
  color:#99cc33;
  border:1px solid #99cc33;
  font-size:.65rem;
  background:transparent;
}
</style>
</head>
<body>

<nav class="navbar fixed-top">
  <div class="container">
    <a class="navbar-brand" href="/">BaskinBros</a>
    <span class="navbar-text">Goji Software List</span>
  </div>
</nav>

<div class="container" style="padding-top:80px;">
  <h1 class="text-center mb-3">Goji Software List</h1>
  <p class="text-center mb-4">Some tools for tinkering, dev, media, retro/emulation, etc.</p>
  <div id="accordionMount" class="accordion"></div>
</div>

<script>
window.PLACEHOLDER_ICON = "https://baskinbros.com/software/Grax_72x72px.png";

function isGithub(url){
  try{ return new URL(url).hostname.includes("github.com"); }
  catch{ return false; }
}
function getGithubSlug(url){
  try{
    const u = new URL(url);
    const p = u.pathname.split("/").filter(Boolean);
    if (u.hostname==="github.com" && p.length>=2) return `${p[0]}/${p[1]}`;
  }catch{}
  return "";
}

function candidateIconsFor(item){
  const list = [];

  // Manual
  if (item.img?.trim()) list.push(item.img.trim());

  // GitHub OpenGraph
  if (isGithub(item.link)) {
    const slug = item.github?.trim() || getGithubSlug(item.link);
    if (slug) list.push(`https://opengraph.githubassets.com/1/${slug}`);
  }

  try{
    const u = new URL(item.link);
    const base = `${u.protocol}//${u.hostname}`;

    const hiRes = [
      "/android-chrome-512x512.png","/android-chrome-384x384.png",
      "/android-chrome-256x256.png","/android-chrome-192x192.png",
      "/apple-touch-icon.png",
      "/logo512.png","/logo256.png","/logo192.png",
      "/favicon-196x196.png","/favicon-180x180.png",
      "/favicon-152x152.png","/favicon-144x144.png",
      "/favicon-128x128.png"
    ];

    const midRes = [
      "/logo.png","/logo.svg",
      "/img/logo.png","/img/logo.svg",
      "/static/logo.png","/static/logo.svg",
      "/favicon-96x96.png","/favicon-64x64.png",
      "/favicon-48x48.png","/favicon-32x32.png"
    ];

    const services = [
      "/favicon.ico",
      `https://www.google.com/s2/favicons?domain=${u.hostname}&sz=256`,
      `https://www.google.com/s2/favicons?domain=${u.hostname}&sz=128`,
      `https://favicone.com/${u.hostname}?s=256`,
      `https://api.microlink.io/?url=${u.origin}&embed=logo`,
      `https://favicon.zhusl.com/ico?url=${u.hostname}`
    ];

    [...hiRes, ...midRes, ...services].forEach(p =>
      list.push(p.startsWith("http") ? p : base + p)
    );

  }catch{}

  list.push(window.PLACEHOLDER_ICON);
  return list;
}

function onIconLoaded(img){
  const w = img.naturalWidth, h = img.naturalHeight;
  if (!w || !h || w <= 8 || h <= 8 || w/h > 4 || h/w > 4) onIconError(img);
}

function onIconError(img){
  const idx = Number(img.dataset.idx||"0");
  const icons = JSON.parse(img.dataset.icons||"[]");
  const next = idx+1;
  if (icons[next]){
    img.dataset.idx = String(next);
    img.src = icons[next];
  } else {
    img.onerror = null;
    img.src = window.PLACEHOLDER_ICON;
  }
}

async function loadSoftware(){
  const res = await fetch("software.json",{cache:"no-store"});
  renderSoftware(await res.json());
}

function renderSoftware(data){
  const el = document.getElementById("accordionMount");
  el.innerHTML = (data.categories||[]).map((cat,i)=>`
    <div class="accordion-item">
      <h2 class="accordion-header" id="h${i}">
        <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#c${i}">
          ${cat.emoji||""} ${cat.name}
        </button>
      </h2>
      <div id="c${i}" class="accordion-collapse collapse">
        <div class="accordion-body">
          <div class="row g-3">
            ${(cat.items||[]).map(it=>{
              const icons = candidateIconsFor(it);
              const first = icons[0] || window.PLACEHOLDER_ICON;
              const enc = JSON.stringify(icons).replace(/"/g,"&quot;");
              return `
              <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex">
                <div class="card w-100">
                  <img class="card-img-top"
                       src="${first}"
                       data-icons="${enc}"
                       data-idx="0"
                       alt="${it.title} icon"
                       onload="onIconLoaded(this)"
                       onerror="onIconError(this)">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">${it.title}</h5>
                    <p class="card-text flex-grow-1">${it.desc}</p>
                    <a href="${it.link}" target="_blank" rel="noopener" class="btn btn-goji w-100">Visit</a>
                  </div>
                </div>
              </div>`;
            }).join("")}
          </div>
        </div>
      </div>
    </div>
  `).join("");
}

loadSoftware();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
